#!/bin/bash

cmake_file="$(rospack find aero_description)/../aero_startup/CMakeLists.txt"

# installation :
# find_package(Protobuf REQUIRED)
# include_directories(${PROTOBUF_INCLUDE_DIRS})
# find_package(Threads)
# find_library(PROTOBUF_LIBRARY protobuf /usr/local/lib)
# find_library(GRPC_LIBRARY grpc /usr/local/lib)
# find_library(GRPC++_LIBRARY grpc++_unsecure /usr/local/lib)
# find_library(GPR_LIBRARY gpr /usr/local/lib)
# message(STATUS "protobuf : " ${PROTOBUF_INCLUDE_DIRS})
# message(STATUS "protobuf library : " ${PROTOBUF_LIBRARY})
# message(STATUS "grpc library : " ${GRPC_LIBRARY})
# message(STATUS "grpc++ library : " ${GRPC++_LIBRARY})
# message(STATUS "gpr library : " ${GPR_LIBRARY})
# add_executable(kinect_client sandbox/IREX/KinectClient.cc
#   sandbox/IREX/body_skeleton.pb.cc sandbox/IREX/body_skeleton.grpc.pb.cc)
# target_link_libraries(kinect_client
#   ${catkin_LIBRARIES} ${Boost_LIBRARIES}
#   ${GRPC++_LIBRARY} ${GRPC_LIBRARY} ${GPR_LIBRARY}
#   ${PROTOBUF_LIBRARY} ${CMAKE_THREAD_LIBS_INIT} dl)
# end installation

awk "/# installation :/,/# end installation/" $(rospack find aero_description)/../aero_startup/sandbox/IREX/.install > /tmp/install_sandbox_irex
sed -i "/# installation :/d" /tmp/install_sandbox_irex
sed -i "/# end installation/d" /tmp/install_sandbox_irex
sed -i "s/# //g" /tmp/install_sandbox_irex

tab2=$'  '
write_to_line=$(grep -n -m 1 ">>> add applications" $cmake_file | cut -d ':' -f1)
write_to_line=$(($write_to_line + 1))

IFS=''
while read line
do
    echo "${line}" | xargs -0 -I{} sed -i "${write_to_line}i\{}" $cmake_file
    write_to_line=$(($write_to_line + 1))
done < /tmp/install_sandbox_irex
